# Standards: 1.0.0
---

# 5.3.2 Ensure lockout for failed password attempts is configured

- name: 5.3.2 - Ensure lockout for failed password attempts is configured
  replace:
      path: "{{ item }}"
      regexp: '^auth        required      pam_env.so'
      replace: 'auth        required pam_faillock.so preauth audit silent deny=5 unlock_time=900'
  with_items:
    - /etc/pam.d/system-auth
    - /etc/pam.d/password-auth
  tags:
    - level-1
    - section-5
    - section-5.3
    - section-5.3.2
    - "5.3.2"
    - scored

- name: 5.3.2 - Ensure lockout for failed password attempts is configured
  replace:
      path: "{{ item }}"
      regexp: '^auth        required      pam_deny.so'
      replace: 'auth        [success=1 default=bad] pam_unix.so'
  with_items:
    - /etc/pam.d/system-auth
    - /etc/pam.d/password-auth
  tags:
    - level-1
    - section-5
    - section-5.3
    - section-5.3.2
    - "5.3.2"
    - scored

- name: 5.3.2 - Ensure lockout for failed password attempts is configured
  replace:
      path: "{{ item }}"
      regexp: '^auth        sufficient    pam_unix.so try_first_pass nullok'
      replace: 'auth        sufficient    pam_faillock.so authsucc audit deny=5 unlock_time=900'
  with_items:
    - /etc/pam.d/system-auth
    - /etc/pam.d/password-auth
  tags:
    - level-1
    - section-5
    - section-5.3
    - section-5.3.2
    - "5.3.2"
    - scored

- name: 5.3.2 - Ensure lockout for failed password attempts is configured
  lineinfile:
      dest: "{{ item }}"
      line: 'auth        [default=die] pam_faillock.so authfail audit deny=5 unlock_time=900'
  with_items:
    - /etc/pam.d/system-auth
    - /etc/pam.d/password-auth
  tags:
    - level-1
    - section-5
    - section-5.3
    - section-5.3.2
    - "5.3.2"
    - scored